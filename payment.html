<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil Project Reports</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Button to initiate UPI payment -->
    <button onclick="initiateUPIPayment('projectID123')">Pay with UPI</button>

    <script>
        function initiateUPIPayment(projectID) {
            const upiID = 'projectbuilders@upi'; // Your UPI ID
            const amount = '100'; // Payment amount
            const name = 'Meyyarasu A'; // Merchant name
            const txnNote = 'Payment for Civil Project'; // Transaction note
            const txnID = 'TXN' + Date.now(); // Unique transaction ID

            // Construct UPI Intent URL
            const upiURL = `upi://pay?pa=${upiID}&pn=${name}&am=${amount}&tn=${txnNote}&cu=INR&tid=${txnID}`;

            // Trigger UPI payment
            window.location.href = upiURL;

            // After payment, prompt user to enter the transaction ID manually
            setTimeout(() => {
                const userTxnID = prompt("Please enter the UPI transaction ID after your payment:");
                if (userTxnID) {
                    verifyPayment(userTxnID, projectID);
                } else {
                    alert("Transaction ID is required to proceed.");
                }
            }, 5000); // Wait for 5 seconds before prompting the user
        }

        // Function to send the transaction ID to the backend for verification
        async function verifyPayment(transactionID, projectID) {
            try {
                const response = await fetch('https://your-backend-server.com/verify-upi-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ transactionID, projectID }),
                });

                if (response.ok) {
                    alert('Payment verified successfully!');
                    window.location.href = `https://prjctbuilds.unaux.com/handler.html?project=${projectID}`;
                } else {
                    alert('Payment verification failed. Please try again or contact support.');
                }
            } catch (error) {
                alert('An error occurred during payment verification. Please try again later.');
            }
        }
    </script>
    <script>const express = require('express');
        const bodyParser = require('body-parser');
        const axios = require('axios');
        
        const app = express();
        app.use(bodyParser.json());
        
        // Endpoint to verify UPI payment
        app.post('/verify-upi-payment', async (req, res) => {
            const { transactionID, projectID } = req.body;
        
            try {
                // Example: Using Razorpay's API to verify UPI transaction
                // Note: Replace with actual API and credentials
                const response = await axios.get(`https://api.razorpay.com/v1/payments/${transactionID}`, {
                    headers: {
                        'Authorization': `Basic ${Buffer.from('your_key_id:your_key_secret').toString('base64')}`
                    }
                });
        
                if (response.data.status === 'captured' || response.data.status === 'success') {
                    // Payment verified, redirect to the handler page
                    res.redirect(`https://prjctbuilds.unaux.com/handler.html?project=${projectID}`);
                } else {
                    // Payment not successful
                    res.status(400).send('Payment verification failed.');
                }
            } catch (error) {
                console.error('Error verifying UPI payment:', error);
                res.status(500).send('Internal Server Error');
            }
        });
        
        // Start the server
        const PORT = process.env.PORT || 3000;
        app.listen(PORT, () => {
            console.log(`Server is running on port ${PORT}`);
        });
        </script>
</body>
</html>
